{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Generate Payslip - NAS Payslip System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h2 class="mb-4"><i class="bi bi-file-earmark-plus"></i> Generate Payslip</h2>
        <div class="btn-group mb-4" role="group" aria-label="Generate mode">
            <a href="{% url 'payroll:payslip_generate' %}" class="btn btn-primary">
                <i class="bi bi-person-plus me-2"></i> Individual
            </a>
            <a href="{% url 'payroll:payslip_bulk_generate' %}" class="btn btn-outline-primary">
                <i class="bi bi-collection-play me-2"></i> Bulk Process
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                Payslip Details
            </div>
            <div class="card-body">
                <form method="post" id="payslipForm">
                    {% csrf_token %}

                    {% if form.errors %}
                    <div class="alert alert-danger">
                        Please correct the errors below.
                    </div>
                    {% endif %}

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="form-label">Select Employee *</label>
                            {{ form.employee }}
                            <small class="form-text text-muted">{{ form.employee.help_text }}</small>
                            <div class="text-danger">{{ form.employee.errors }}</div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Month/Year *</label>
                            {{ form.month_year }}
                            <div class="text-danger">{{ form.month_year.errors }}</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">District *</label>
                            {{ form.district }}
                        </div>
                    </div>

                    <h5 class="card-title text-primary border-bottom pb-2 mb-3 mt-4">Employee Snapshot</h5>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label class="form-label">Department</label>
                            {{ form.department }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Unit</label>
                            {{ form.unit }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Grade</label>
                            {{ form.grade }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Level</label>
                            {{ form.level }}
                        </div>
                    </div>

                    <h5 class="card-title text-primary border-bottom pb-2 mb-3 mt-4">Financials</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Basic Salary *</label>
                            <div class="input-group">
                                <span class="input-group-text">GHS</span>
                                {{ form.basic_salary }}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">SSNIT Rate (%)</label>
                            {{ form.ssnit_rate }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Tier 2 Rate (%)</label>
                            {{ form.tier2_rate }}
                        </div>
                    </div>

                    <div class="alert alert-info mt-4">
                        <i class="bi bi-info-circle"></i> <strong>Note:</strong> The payslip will be created with
                        <strong>Pending</strong> status. You must approve it before the staff member can view or
                        download it.
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'accounts:dashboard' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-file-earmark-plus"></i> Generate Payslip
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<!-- Select2 CSS -->
<link href="{% static 'vendor/select2/css/select2.min.css' %}" rel="stylesheet" />
<link href="{% static 'vendor/select2-bootstrap-5-theme/select2-bootstrap-5-theme.min.css' %}" rel="stylesheet" />
{% endblock %}

{% block extra_js %}
<!-- Employee Details Data -->
<script id="employee-details-data" type="application/json">
    {{ employee_details_json|safe }}
</script>
<!-- jQuery (required for Select2) -->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<!-- Select2 JS -->
<script src="{% static 'vendor/select2/js/select2.min.js' %}"></script>

<!-- Employee Salaries Data -->
<script id="employee-salaries-data" type="application/json">
    {{ employee_salaries_json|safe }}
</script>
<script src="{% static 'payroll/js/payslip_generate.js' %}"></script>
{% endblock %}
